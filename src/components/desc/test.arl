archetype test

variable bar : nat = 0

entry getBar(cb : contract<int>) {
  transfer transferred to entry cb(bar)
}
record voter {
  weight   : nat;
  voted    : bool = false;
  delegate : option<address> = none;
  vote     : nat;
}

asset partitioned identified by k {
  k : nat;
  v : nat
}

states =
| OK
| KO
| Canceled

transition accept(success : bool) {
  refuse transfer
  sourced by selfaddress
  from KO
  to OK when { success } with effect {
    transfer balance to selfaddress
  }
  to Canceled /* when success is false */
}

transition tr() {
    from OK to KO
}

asset partitioning identified by a {
  a      : address;
  assets : aggregate<partitioned>
}

entry exec () {
    require {
        r1: transferred > 2tz
    }
    effect {
        var vo = { weight = 1; vote = 234523 };
        partitioned.add({ k = 0; v = 0 })
    }
}